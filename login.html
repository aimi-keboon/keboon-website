<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign In - Keboon Directory</title>

    <!-- Leaflet CSS for map in signup -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css"
    />

    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #1b5e3f 0%, #52ae77 100%);
        min-height: 100vh;
        display: flex;
        align-items: flex-start;
        justify-content: center;
        padding: 20px;
        overflow-y: auto;
      }

      .container {
        width: 100%;
        max-width: 900px;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        overflow: hidden;
        margin-top: 20px;
        margin-bottom: 20px;
      }

      .header {
        background: linear-gradient(135deg, #2d5016 0%, #3f6b20 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .logo-container {
        margin-bottom: 20px;
      }

      .logo {
        max-height: 50px;
        width: auto;
        filter: brightness(0) invert(1);
      }

      .header h1 {
        font-size: 1.8rem;
        margin-bottom: 8px;
        font-weight: 300;
      }

      .header p {
        opacity: 0.9;
        font-size: 1rem;
      }

      .form-container {
        padding: 40px 30px;
      }

      .tab-buttons {
        display: flex;
        margin-bottom: 30px;
        background: #f8f9fa;
        border-radius: 10px;
        padding: 4px;
      }

      .tab-btn {
        flex: 1;
        padding: 12px;
        background: none;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        color: #6c757d;
      }

      .tab-btn.active {
        background: #3f6b20;
        color: white;
        box-shadow: 0 2px 8px rgba(63, 107, 32, 0.3);
      }

      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        font-weight: 600;
        color: #2d5016;
        margin-bottom: 8px;
        font-size: 0.95rem;
      }

      .required::after {
        content: " *";
        color: #dc3545;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 14px 16px;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        font-size: 1rem;
        transition: all 0.3s ease;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #3f6b20;
        box-shadow: 0 0 0 3px rgba(63, 107, 32, 0.1);
      }

      .form-group textarea {
        resize: vertical;
        min-height: 100px;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
      }

      .phone-input-container {
        display: flex;
        gap: 0;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        overflow: hidden;
        transition: all 0.3s ease;
        background: white;
      }

      .phone-input-container:focus-within {
        border-color: #3f6b20;
        box-shadow: 0 0 0 3px rgba(63, 107, 32, 0.1);
      }

      .country-code-select {
        border: none;
        background: #f8f9fa;
        padding: 14px 8px;
        font-size: 0.85rem;
        font-weight: 600;
        color: #2d5016;
        width: 85px;
        flex-shrink: 0;
        border-right: 2px solid #e9ecef;
        outline: none;
        cursor: pointer;
      }

      .country-code-select:focus {
        background: #e9ecef;
      }

      .phone-input-container input[type="tel"] {
        border: none;
        padding: 14px 16px;
        font-size: 1rem;
        flex: 1;
        outline: none;
        background: white;
      }

      .phone-input-container input[type="tel"]:focus {
        border: none;
        box-shadow: none;
      }

      .help-text {
        font-size: 0.85rem;
        color: #6c757d;
        margin-top: 6px;
      }

      .btn {
        width: 100%;
        padding: 14px;
        border: none;
        border-radius: 10px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .btn-primary {
        background: #3f6b20;
        color: white;
      }

      .btn-primary:hover {
        background: #2d5016;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(63, 107, 32, 0.3);
      }

      .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
        margin-top: 15px;
      }

      .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
      }

      .btn-icon {
        width: 18px;
        height: 18px;
        fill: currentColor;
      }

      /* Location Section */
      .location-section {
        border: 2px solid #e9ecef;
        border-radius: 15px;
        padding: 25px;
        background: white;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        margin-bottom: 20px;
      }

      .location-input-row {
        display: grid;
        grid-template-columns: 1fr 1fr auto;
        gap: 15px;
        margin-bottom: 20px;
        align-items: end;
      }

      #signupLocationMap {
        height: 300px;
        width: 100%;
        border-radius: 12px;
        border: 2px solid #ced4da;
      }

      .map-instructions {
        background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        border: 2px solid #2196f3;
        border-radius: 12px;
        padding: 15px;
        margin-top: 15px;
        text-align: center;
      }

      .map-instructions p {
        margin: 0;
        color: #1976d2;
        font-size: 1rem;
        font-weight: 600;
      }

      /* Tables for products and websites */
      .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      }

      .data-table th,
      .data-table td {
        padding: 15px;
        text-align: left;
        border-bottom: 1px solid #dee2e6;
        vertical-align: middle;
      }

      .data-table th {
        background: #f8f9fa;
        font-weight: 600;
        color: #2d5016;
        font-size: 1rem;
      }

      .data-table input,
      .data-table select {
        margin: 0;
        border: 1px solid #ced4da;
        padding: 10px 14px;
        font-size: 1rem;
        border-radius: 8px;
        width: 100%;
      }

      .data-table input[type="number"] {
        width: 100px;
      }

      .add-row-btn {
        background: #28a745;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        margin-top: 15px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .add-row-btn:hover {
        background: #218838;
      }

      .remove-btn {
        background: #dc3545;
        color: white;
        padding: 6px 12px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.85rem;
      }

      .remove-btn:hover {
        background: #c82333;
      }

      .remove-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .radio-group {
        display: flex;
        gap: 25px;
        margin-top: 10px;
      }

      .radio-label {
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: normal;
        cursor: pointer;
        font-size: 1rem;
      }

      .radio-label input[type="radio"] {
        width: auto;
        margin: 0;
        transform: scale(1.2);
      }

      .forgot-section {
        margin-top: 25px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 10px;
        border: 1px solid #e9ecef;
      }

      .forgot-section h4 {
        color: #2d5016;
        margin-bottom: 10px;
        font-size: 1rem;
      }

      .forgot-section p {
        color: #6c757d;
        margin-bottom: 15px;
        font-size: 0.9rem;
      }

      .forgot-input-group {
        display: flex;
        gap: 10px;
        align-items: end;
      }

      .forgot-input-group input {
        flex: 1;
      }

      .forgot-input-group button {
        background: #28a745;
        color: white;
        padding: 14px 20px;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        white-space: nowrap;
      }

      .forgot-input-group button:hover {
        background: #218838;
        transform: translateY(-1px);
      }

      .forgot-input-group button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .back-link {
        text-align: center;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid #e9ecef;
      }

      .back-link a {
        color: #3f6b20;
        text-decoration: none;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .back-link a:hover {
        text-decoration: underline;
      }

      .error-message {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        color: #721c24;
        padding: 12px 16px;
        border: 2px solid #f5c6cb;
        border-radius: 8px;
        margin-bottom: 20px;
        display: none;
        font-weight: 600;
        font-size: 0.9rem;
      }

      .success-message {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        color: #155724;
        padding: 12px 16px;
        border: 2px solid #c3e6cb;
        border-radius: 8px;
        margin-bottom: 20px;
        display: none;
        font-weight: 600;
        font-size: 0.9rem;
      }

      /* Message Popup Styles */
      .message-popup {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        backdrop-filter: blur(5px);
      }

      .message-popup-content {
        border-radius: 20px;
        padding: 30px;
        max-width: 500px;
        width: 90%;
        text-align: center;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        position: relative;
        animation: popupSlideIn 0.3s ease-out;
      }

      @keyframes popupSlideIn {
        from {
          transform: scale(0.7) translateY(-50px);
          opacity: 0;
        }
        to {
          transform: scale(1) translateY(0);
          opacity: 1;
        }
      }

      .message-popup-content.success {
        background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
        border: 3px solid #28a745;
      }

      .message-popup-content.error {
        background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
        border: 3px solid #dc3545;
      }

      .message-popup-header {
        font-size: 2rem;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .message-popup-header.success {
        color: #155724;
      }

      .message-popup-header.error {
        color: #721c24;
      }

      .popup-icon {
        width: 32px;
        height: 32px;
        fill: currentColor;
      }

      .message-popup-message {
        font-size: 1.1rem;
        margin-bottom: 25px;
        line-height: 1.5;
        font-weight: 600;
      }

      .message-popup-message.success {
        color: #155724;
      }

      .message-popup-message.error {
        color: #721c24;
      }

      .keboon-id-highlight {
        background: #28a745;
        color: white;
        padding: 8px 15px;
        border-radius: 25px;
        font-weight: 700;
        font-size: 1.2rem;
        display: inline-block;
        margin: 10px 0;
        letter-spacing: 1px;
      }

      .message-popup-close {
        border: none;
        padding: 12px 30px;
        border-radius: 25px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        display: flex;
        align-items: center;
        gap: 8px;
        margin: 0 auto;
      }

      .message-popup-close.success {
        background: #28a745;
        color: white;
      }

      .message-popup-close.success:hover {
        background: #218838;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
      }

      .message-popup-close.error {
        background: #dc3545;
        color: white;
      }

      .message-popup-close.error:hover {
        background: #c82333;
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(220, 53, 69, 0.4);
      }

      .message-popup-close-x {
        position: absolute;
        top: 15px;
        right: 20px;
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.3s ease;
      }

      .message-popup-close-x.success {
        color: #155724;
      }

      .message-popup-close-x.success:hover {
        background: rgba(21, 87, 36, 0.1);
      }

      .message-popup-close-x.error {
        color: #721c24;
      }

      .message-popup-close-x.error:hover {
        background: rgba(114, 28, 36, 0.1);
      }

      .message-popup-close-x:hover {
        transform: rotate(90deg);
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        body {
          padding: 10px;
        }

        .container {
          max-width: 100%;
        }

        .header {
          padding: 25px 20px;
        }

        .form-container {
          padding: 30px 20px;
        }

        .forgot-input-group {
          flex-direction: column;
          gap: 15px;
        }

        .forgot-input-group button {
          width: 100%;
        }

        .phone-input-container {
          flex-direction: column;
        }

        .country-code-select {
          border-right: none;
          border-bottom: 2px solid #e9ecef;
          width: 100%;
        }

        .form-row {
          grid-template-columns: 1fr;
        }

        .location-input-row {
          grid-template-columns: 1fr;
        }

        .radio-group {
          flex-direction: column;
          gap: 15px;
        }

        .data-table,
        .data-table thead,
        .data-table tbody,
        .data-table th,
        .data-table td,
        .data-table tr {
          display: block;
        }

        .data-table thead tr {
          position: absolute;
          top: -9999px;
          left: -9999px;
        }

        .data-table tr {
          border: 2px solid #ddd;
          margin-bottom: 15px;
          padding: 15px;
          border-radius: 12px;
          background: white;
        }

        .data-table td {
          border: none;
          position: relative;
          padding: 10px 0 10px 35%;
          border-bottom: 1px solid #eee;
        }

        .data-table td:before {
          content: attr(data-label);
          position: absolute;
          left: 6px;
          width: 30%;
          padding-right: 10px;
          white-space: nowrap;
          font-weight: 600;
          color: #2d5016;
          font-size: 0.9rem;
        }

        .data-table input,
        .data-table select {
          width: 100%;
          font-size: 1rem;
        }
      }

      @media (max-width: 480px) {
        .header h1 {
          font-size: 1.5rem;
        }

        .form-container {
          padding: 25px 15px;
        }

        .tab-btn {
          padding: 10px;
          font-size: 0.9rem;
        }

        #signupLocationMap {
          height: 250px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <div class="logo-container">
          <img
            src="assets/img/keboon-logo-white.png"
            alt="Keboon Logo"
            class="logo"
            id="keboonLogo"
          />
        </div>
        <h1>Welcome to Keboon</h1>
        <p>Sign in to manage your farm or create a new account</p>
      </div>

      <!-- Form Container -->
      <div class="form-container">
        <!-- Tab Buttons -->
        <div class="tab-buttons">
          <button class="tab-btn active" onclick="switchTab('signin')">
            Sign In
          </button>
          <button class="tab-btn" onclick="switchTab('signup')">
            Join as Farmer
          </button>
        </div>

        <!-- Sign In Tab -->
        <div class="tab-content active" id="signinTab">
          <div class="error-message" id="signinError"></div>
          <div class="success-message" id="signinSuccess"></div>

          <form id="signinForm">
            <div class="form-group">
              <label for="signinKeboonId" class="required">Keboon ID</label>
              <input
                type="text"
                id="signinKeboonId"
                placeholder="Enter your Keboon ID (e.g., KB123ABC...)"
                required
              />
              <div class="help-text">
                Your unique Keboon ID received when you added your farm
              </div>
            </div>

            <div class="form-group">
              <label for="signinPhone" class="required">Phone Number</label>
              <div class="phone-input-container">
                <select
                  id="signinCountryCode"
                  class="country-code-select"
                  required
                >
                  <option value="+60">🇲🇾 +60</option>
                  <option value="+65">🇸🇬 +65</option>
                  <option value="+62">🇮🇩 +62</option>
                  <option value="+66">🇹🇭 +66</option>
                  <option value="+84">🇻🇳 +84</option>
                  <option value="+63">🇵🇭 +63</option>
                  <option value="+673">🇧🇳 +673</option>
                  <option value="+856">🇱🇦 +856</option>
                  <option value="+855">🇰🇭 +855</option>
                  <option value="+95">🇲🇲 +95</option>
                  <option value="+1">🇺🇸 +1</option>
                  <option value="+44">🇬🇧 +44</option>
                  <option value="+61">🇦🇺 +61</option>
                  <option value="+86">🇨🇳 +86</option>
                  <option value="+81">🇯🇵 +81</option>
                  <option value="+82">🇰🇷 +82</option>
                  <option value="+91">🇮🇳 +91</option>
                </select>
                <input
                  type="tel"
                  id="signinPhone"
                  placeholder="123456789"
                  pattern="[0-9]+"
                  title="Please enter numbers only (without country code)"
                  required
                />
              </div>
              <div class="help-text">
                Enter your phone number without the country code
              </div>
            </div>

            <button type="submit" class="btn btn-primary" id="signinBtn">
              <svg class="btn-icon" viewBox="0 0 24 24">
                <path d="M10,17V14H3V10H10V7L15,12L10,17M10,2H19A2,2 0 0,1 21,4V20A2,2 0 0,1 19,22H10A2,2 0 0,1 8,20V18H10V20H19V4H10V6H8V4A2,2 0 0,1 10,2Z"/>
              </svg>
              Sign In
            </button>
          </form>

          <!-- Forgot Keboon ID Section -->
          <div class="forgot-section">
            <h4>Forgot Your Keboon ID?</h4>
            <p>
              Enter your registered email address and we'll send your Keboon ID to you.
            </p>
            <div class="forgot-input-group">
              <input
                type="email"
                id="forgotEmail"
                placeholder="Email Address"
              />
              <button
                type="button"
                onclick="sendKeboonId()"
                id="forgotBtn"
              >
                <svg class="btn-icon" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                  <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/>
                </svg>
                Send
              </button>
            </div>
          </div>
        </div>

        <!-- Sign Up Tab - Farm Registration Form -->
        <div class="tab-content" id="signupTab">
          <div class="error-message" id="signupError"></div>
          <div class="success-message" id="signupSuccess"></div>

          <form id="signupForm">
            <div class="form-group">
              <label for="signupFarmName" class="required">Farm/Business Name</label>
              <input type="text" id="signupFarmName" name="farmName" required />
            </div>

            <div class="form-group">
              <label for="signupContactName" class="required">Contact Person Name</label>
              <input type="text" id="signupContactName" name="contactName" required />
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="signupCategory" class="required">Farm Category</label>
                <select id="signupCategory" name="category" required>
                  <option value="">Select Category</option>
                  <option value="Home Grower">Home Grower (micro/backyard)</option>
                  <option value="Homesteading">Homesteading (medium-small)</option>
                  <option value="Small Scale">Small Scale (&lt;1.5 ha)</option>
                  <option value="Medium Scale">Medium Scale</option>
                  <option value="Large Scale">Large Scale</option>
                </select>
              </div>

              <div class="form-group">
                <label for="signupCommercial" class="required">Commercial Status</label>
                <select id="signupCommercial" name="commercial" required>
                  <option value="">Select Status</option>
                  <option value="Commercial">Commercial</option>
                  <option value="Non-commercial">Non-commercial</option>
                </select>
              </div>
            </div>

            <div class="form-group">
              <label for="signupLocation" class="required">Farm Location</label>
              <div class="location-section">
                <div class="location-input-row">
                  <input
                    type="number"
                    id="signupLatitude"
                    name="latitude"
                    step="any"
                    required
                    placeholder="Latitude (e.g., 3.139)"
                    oninput="autoUpdateMapFromCoordinates()"
                  />
                  <input
                    type="number"
                    id="signupLongitude"
                    name="longitude"
                    step="any"
                    required
                    placeholder="Longitude (e.g., 101.6869)"
                    oninput="autoUpdateMapFromCoordinates()"
                  />
                  <button
                    type="button"
                    class="btn btn-primary"
                    onclick="getCurrentLocation()"
                    style="width: auto; padding: 12px 20px;"
                  >
                    <svg class="btn-icon" viewBox="0 0 24 24">
                      <path d="M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2Z"/>
                    </svg>
                    Use My Location
                  </button>
                </div>
                <div id="signupLocationMap"></div>
                <div class="map-instructions">
                  <p>Click on the map to set your farm location</p>
                </div>
              </div>
            </div>

            <div class="form-row">